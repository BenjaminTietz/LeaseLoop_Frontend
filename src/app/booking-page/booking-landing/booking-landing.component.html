<main>
    <content>
        <!-- Header -->
        <div class="booking-header">
            <app-logo
                [ngClass]="navigator.actualRoute() == 'owner/legal-notice' || navigator.actualRoute() == 'owner/privacy-policy' || navigator.actualRoute() == 'owner/' ? 'logo-scrollbar' : ''"
                (click)="this.navigator.navigateTo('/')"></app-logo>
            <p>Your gateway to the perfect rental property</p>
            <div (click)="this.navigator.navigateTo('owner')" class="btn">Register your property</div>
            <app-theme-button></app-theme-button>
        </div>
        <!-- Router Outlet -->
        <router-outlet></router-outlet>
        <!-- Conditional Main Landing Content -->
        <ng-container
            *ngIf="!bookingService.selectedPropertyDetail() && !navigator.actualRoute().includes('/unit/') && !navigator.actualRoute().includes('/property/')">
            <!-- Landing view above selector -->
            <section class="landing-view">
                <h1>Find your perfect rental property</h1>
                <p>Explore our selection of properties and book your next stay with us.</p>
                <div class="btn" (click)="this.navigator.navigateTo('owner')">Register your property</div>
            </section>
            <!-- Selector selection -->
            <section class="selector">
                <!-- Combined Search Input -->
                <div class="selector-container">
                    <div class="custom-dropdown">
                        <label for="location">Search City or Country</label>
                        <div class="input-wrapper">
                            <input id="location" type="text" placeholder="Start typing..." [value]="searchInput()"
                                (input)="onLocationInput($event)" (focus)="showLocationDropdown.set(true)"
                                (blur)="onBlurDropdownClose()" />

                            <span *ngIf="searchInput()" class="clear-icon"
                                (mousedown)="clearSearchInput()">&#10005;</span>
                        </div>
                        @if (showLocationDropdown() && filteredLocations().length > 0) {
                        <ul class="dropdown-list">
                            @for (location of filteredLocations(); track location) {
                            <li (mousedown)="onLocationSelect(location)">{{ location }}</li>
                            }
                        </ul>
                        }
                    </div>
                    <!-- Date selection -->
                    <div class="date-selector">
                        <div class="date-input">
                            <p>Check-in</p>
                            <input type="date" [min]="today" [value]="bookingService.checkInDate()"
                                (input)="setCheckInFromEvent($event)" />
                        </div>
                        <div class="date-input">
                            <p>Check-out</p>
                            <input type="date" [min]="today" [value]="bookingService.checkOutDate()"
                                (input)="setCheckOutFromEvent($event)" />
                        </div>
                        <div class="date-input guest-count">
                            <p>Guests</p>
                            <input type="number" [min]="1" [max]="maxGuestCapacity()"
                                [value]="bookingService.guestCount()" (input)="setGuestCountFromEvent($event)" />
                        </div>
                        <button class="btn search-btn" (click)="searchAvailableUnits()">Search</button>
                    </div>
                </div>
                @if (bookingService.guestCount() >= maxGuestCapacity()) {
                <p class="info">Max. guest capacity reached â€“ please reduce guest count or change filters.</p>
                }
            </section>
            <!-- Mainarea -->
            <ng-container *ngIf="searchIsComplete(); else noResultsView">
                <section>
                    <h2>Available Properties</h2>
                    <div class="grid">
                        @for (property of bookingService.properties(); track property.id) {
                        <div class="card"
                            (click)="navigator.navigateTo('property/' + property.id); this.bookingService.selectProperty(property.id)">
                            <img *ngIf="property.images && property.images.length > 0; else noImage"
                                [src]="property.images[0].image" [alt]="property.images[0].alt_text || property.name" />
                            <ng-template #noImage>
                                <img src="no_picture.png" alt="No image available" />
                            </ng-template>
                            <h3>{{ property.name }}</h3>
                            <p>{{ property.address.city }}, {{ property.address.country }}</p>
                            <p>{{ property.units.length }} Unit{{ property.units.length > 1 ? 's' : '' }}</p>
                        </div>
                        }
                    </div>
                    <button class="btn reset-btn" (click)="resetFilters()">Reset search</button>
                </section>
            </ng-container>
            <ng-template #noResultsView>
                <section class="default-suggestion">
                    <h2>Plan your next getaway</h2>
                    <p>Search by location, date and number of guests to find properties that match your needs.</p>
                    <div class="how-to-book">
                        <div class="step">
                            <img src="/booking-page/search-globe-svgrepo-com.svg" alt="Search" />
                            <h3>1. Search</h3>
                            <p>Choose your destination, travel dates and guest number.</p>
                        </div>
                        <div class="step">
                            <img src="/booking-page/gui-git-compare-svgrepo-com.svg" alt="Select" />
                            <h3>2. Compare & Select</h3>
                            <p>Browse through available properties and pick the perfect one.</p>
                        </div>
                        <div class="step">
                            <img src="/booking-page/buy-svgrepo-com.svg" alt="Book" />
                            <h3>3. Book</h3>
                            <p>Confirm your stay and get ready for your trip!</p>
                        </div>
                    </div>
                </section>
            </ng-template>
        </ng-container>
        <!-- Footer -->
        <app-landing-footer></app-landing-footer>
    </content>
</main>

<app-booking-status-popup *ngIf="bookingService.bookingStatusPopup()"
    [status]="bookingService.bookingStatusPopup()!.status" [bookingId]="bookingService.bookingStatusPopup()!.bookingId"
    (close)="bookingService.closeBookingStatusPopup()">