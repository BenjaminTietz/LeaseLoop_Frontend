<main>
    <form [formGroup]="serviceForm" [appClickOutside]="closeForm">
        @if(clientService.sending()) {
        <app-progress-bar aria-label="Loading"></app-progress-bar>
        }
        <mat-icon aria-label="Close" class="close-icon" (click)="closeForm()">close</mat-icon>
        @if(clientService.selectedClient() === null) {
        <h1>New Client</h1>
        }
        @if(clientService.selectedClient() !== null) {
        <h1>Edit Client</h1>
        }
        <div class="input-area">
            <label for="name">First Name</label>
            <div class="form-field">
                <input type="text" id="first_name" name="first_name" required placeholder="First Name"
                    formControlName="first_name">
                @if(formService.getFormErrors(serviceForm, 'first_name')?.['required']) {
                <small>First Name is required</small>
                }
            </div>
        </div>
        <div class="input-area">
            <label for="name">Last Name</label>
            <div class="form-field">
                <input type="text" id="last_name" name="last_name" required placeholder="Last Name"
                    formControlName="last_name">
                @if(formService.getFormErrors(serviceForm, 'last_name')?.['required']) {
                <small>Last Name is required</small>
                }
            </div>
        </div>
        <div class="input-area">
            <label for="name">Email</label>
            <div class="form-field">
                <input type="email" id="email" name="email" required placeholder="Email" formControlName="email">
                @if(formService.getFormErrors(serviceForm, 'email')?.['required']) {
                <small>Email is required</small>
                }
            </div>
        </div>
        <div class="input-area">
            <label for="address">Address</label>

            <div formGroupName="address">
                <div class="form-field">
                    <input type="text" id="street" placeholder="Street" formControlName="street" required />
                    @if(getFormErrors(serviceForm.get('address.street'))) {
                    <small>Street is required</small>
                    }
                </div>

                <div class="form-field">
                    <input type="text" id="house_number" placeholder="House Number" formControlName="house_number"
                        required />
                    @if(getFormErrors(serviceForm.get('address.house_number'))) {
                    <small>House number is required</small>
                    }
                </div>

                <div class="form-field">
                    <input type="text" id="postal_code" placeholder="Postal Code" formControlName="postal_code"
                        required />
                    @if(getFormErrors(serviceForm.get('address..postal_code')))
                    {
                    <small>Postal code is required</small>
                    }
                </div>

                <div class="form-field">
                    <input type="text" id="city" placeholder="City" formControlName="city" required />
                    @if(getFormErrors(serviceForm.get('address.city'))) {
                    <small>City is required</small>
                    }
                </div>

                <div class="form-field">
                    <input type="text" id="country" placeholder="Country" formControlName="country" required />
                    @if(getFormErrors(serviceForm.get('address..country'))) {
                    <small>Country is required</small>
                    }
                </div>

                <div class="form-field">
                    <input type="text" id="phone" placeholder="Phone" formControlName="phone" required />
                    @if(getFormErrors(serviceForm.get('address..phone'))) {
                    <small>Phone is required</small>
                    }
                </div>
            </div>
        </div>

        <div class="button-area">
            @if(clientService.selectedClient() !== null) {

            <button type="button" (click)="this.clientService.deleteClient(
                this.clientService.selectedClient()!.id
              )">Delete</button>
            <button type="submit" (click)="updateClient()" [disabled]="serviceForm.invalid || clientService.sending() ">
                Update
            </button>
            }
            @if(clientService.selectedClient() === null) {
            <button type="submit" (click)="createClient()" [disabled]="serviceForm.invalid || clientService.sending()">
                Save
            </button>
            }
        </div>
    </form>
</main>